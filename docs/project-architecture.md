# 业主线上投票与自治系统架构设计

## 1. 总体架构设计

### 1.1 系统架构图

```
用户 -> HTTPS -> Nginx代理 -> 前端应用(Vue) <-> 后端API(Spring Boot) <-> MySQL
                                           |                |
                                           |                |-> MinIO(对象存储)
                                           |                |-> PaddleOCR(文字识别)
                                           |
                                           |-> 管理后台(Vue)
```

### 1.2 技术栈选择原因

| 技术 | 选择原因 |
|-----|---------|
| Vue 3 | 轻量级前端框架，易于学习和使用，组件化开发提高复用性 |
| Element Plus | 丰富的UI组件库，适合管理系统界面开发，响应式设计支持多端访问 |
| Spring Boot | 简化Java开发，丰富的生态系统，适合快速开发企业级应用 |
| Spring Security | 提供完善的认证和授权机制，保障系统安全性 |
| MySQL | 成熟的关系型数据库，适合结构化数据存储，易于维护和扩展 |
| MinIO | 轻量级对象存储服务，兼容S3协议，支持私有化部署 |
| PaddleOCR | 开源OCR引擎，支持离线部署，中文识别效果好 |
| Docker | 容器化部署，简化环境配置，提高系统可移植性 |

## 2. 核心模块设计

### 2.1 认证与授权模块

#### 2.1.1 认证流程

```
手机号登录 -> 获取基本信息 -> 上传身份证/房产证 -> OCR识别 -> 信息比对验证 -> 管理员审核 -> 认证完成
```

#### 2.1.2 权限设计

```
系统管理员
  |
  |-- 小区管理员
       |
       |-- 普通业主
```

| 角色 | 权限范围 |
|-----|---------|
| 系统管理员 | 所有功能的完全访问权限，包括系统配置、用户管理、社区管理等 |
| 小区管理员 | 特定小区的管理权限，包括审核业主、发起投票、发布公告等 |
| 普通业主 | 基本功能使用权限，包括参与投票、查看公告、提交意见等 |

### 2.2 投票模块

#### 2.2.1 投票流程

```
创建投票议题 -> 设置投票选项与规则 -> 发布投票 -> 业主投票 -> 投票结束 -> 结果统计与公示
```

#### 2.2.2 投票权重计算

系统支持两种投票权重计算方式：
1. **按户计票**：每户一票，权重相同
2. **按面积计票**：根据业主房产面积计算权重，面积越大权重越高

计算公式：
```
按户计票: 权重 = 1
按面积计票: 权重 = 房产面积 / 总面积系数
```

#### 2.2.3 防篡改机制

1. 每次投票记录包含用户IP、设备信息和时间戳
2. 投票一旦提交不可更改
3. 所有操作记录写入审计日志
4. 投票结果计算时进行权重验证

### 2.3 OCR识别模块

#### 2.3.1 身份证识别

提取信息：
- 姓名
- 身份证号码
- 地址
- 有效期

#### 2.3.2 房产证识别

提取信息：
- 房产证号
- 业主姓名
- 房产地址
- 房产面积

#### 2.3.3 识别流程

```
图片上传 -> 图像预处理 -> OCR文字识别 -> 关键信息提取 -> 数据结构化 -> 返回结果
```

### 2.4 公告与互动模块

#### 2.4.1 公告分类

- 普通通知：小区日常事务通知
- 投票结果：投票结束后的结果公示
- 财务报告：小区收支明细报告
- 其他公告：其他类型公示信息

#### 2.4.2 意见互动流程

```
业主提交意见 -> 其他业主点赞/反对 -> 管理员回复 -> 热门意见列入下次投票议题
```

## 3. 数据流设计

### 3.1 用户认证数据流

```
客户端                                 服务端
  |                                     |
  |--- 1. 发送手机号 ------------------>|
  |<-- 2. 返回验证码 -------------------|
  |--- 3. 提交验证码 ------------------>|
  |<-- 4. 返回Token和用户基本信息 ------|
  |--- 5. 上传身份证/房产证 ------------>|
  |<-- 6. 返回OCR识别结果 --------------|
  |--- 7. 确认信息提交认证申请 --------->|
  |                                     |
  |                  管理员审核         |
  |                     |               |
  |<-- 8. 认证状态通知 -----------------|
```

### 3.2 投票数据流

```
管理员                               业主
  |                                  |
  |-- 1. 创建投票议题和选项 --------->|
  |-- 2. 设置投票规则 -------------->|
  |-- 3. 发布投票 ------------------>|
  |                                  |
  |                  4. 查看投票     |
  |                  5. 提交投票     |
  |<-- 6. 投票数据 ------------------|
  |                                  |
  |-- 7. 投票结束 ------------------>|
  |-- 8. 结果计算 ------------------>|
  |-- 9. 结果公示 ------------------>|
```

## 4. 安全设计

### 4.1 数据安全

#### 4.1.1 数据存储安全

- 身份证号、手机号等敏感信息加密存储
- 身份证照片、房产证照片存储在MinIO中，通过访问控制和临时URL保护
- 数据库定期备份，支持增量备份和全量备份

#### 4.1.2 数据传输安全

- 全站HTTPS加密传输
- API接口参数签名校验
- 敏感信息传输加密

### 4.2 应用安全

#### 4.2.1 认证安全

- JWT Token有效期控制
- 防暴力破解机制
- 多设备登录控制

#### 4.2.2 防攻击措施

- 防SQL注入
- 防XSS攻击
- 防CSRF攻击
- 接口频率限制

### 4.3 业务安全

- 投票权重防作弊设计
- 认证审核多重校验
- 操作日志完整记录

## 5. 扩展性设计

### 5.1 水平扩展

- 前端：支持CDN部署，负载均衡
- 后端：无状态设计，支持集群部署
- 数据库：主从复制，读写分离

### 5.2 垂直扩展

- 模块化设计，支持功能独立部署
- 微服务架构迁移路径
- 组件可替换性设计

### 5.3 集成扩展

- 短信平台集成接口
- 微信公众号/小程序集成接口
- 支付通道集成接口（物业费用支付等）

## 6. 性能设计

### 6.1 关键性能指标

- 页面加载时间 < 2秒
- API响应时间 < 500ms
- 并发用户支持 > 500
- 图片上传识别响应 < 5秒

### 6.2 性能优化措施

- 前端资源压缩、懒加载
- 后端接口缓存设计
- 数据库索引优化
- 大文件分片上传

## 7. 容错与可用性设计

### 7.1 异常处理

- 全局异常处理机制
- 用户操作错误友好提示
- 系统错误优雅降级

### 7.2 监控与告警

- 系统健康状态监控
- 关键操作失败告警
- 资源使用率监控

### 7.3 备份与恢复

- 数据定期备份策略
- 快速恢复机制
- 灾难恢复演练计划 